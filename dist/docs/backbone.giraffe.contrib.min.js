(function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};(function(t,e){var i,n,r,o;return("undefined"!=typeof define&&null!==define?define.amd:void 0)?define("backbone.giraffe.contrib",["jquery","underscore","backbone","backbone.giraffe"],function(i,n,r,o){return t.GiraffeContrib=e(t,i,n,r,o)}):("undefined"!=typeof module&&null!==module?module.exports:void 0)?(i=require("jquery"),o=require("underscore"),n=require("backbone"),r=require("./backbone.giraffe"),module.exports=e(t,i,o,n,r)):t.GiraffeContrib=e(t,t.$,t._,t.Backbone,t.Giraffe)})(this,function(t,i,n,r,o){var s,l;if(!i)throw Error("Giraffe.Contrib cannot find jQuery");if(!n)throw Error("Giraffe.Contrib cannot find Underscore");if(!r)throw Error("Giraffe.Contrib cannot find Backbone");if(!o)throw Error("Giraffe.Contrib cannot find Giraffe");return s=o.Contrib={version:"0.2.7"},l=t.GiraffeContrib,s.noConflict=function(){return t.GiraffeContrib=l,this},s.Controller=function(){function t(t){o.configure(this,t)}return n.extend(t.prototype,r.Events),t}(),s.CollectionView=function(t){function i(){var t;if(i.__super__.constructor.apply(this,arguments),n.defaults(this,this.constructor.getDefaults(this)),n.isArray(this.collection)&&(this.collection=new o.Collection(this.collection)),!this.modelView)throw Error("`modelView` is required");this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset sort",this.render),this.renderOnChange&&this.listenTo(this.collection,"change",this._onChangeModel),this.modelViewEl&&(this.modelViewEl=(null!=(t=this.ui)?t[this.modelViewEl]:void 0)||this.modelViewEl)}return e(i,t),i.getDefaults=function(t){return{collection:t.collection?null:new o.Collection,modelView:o.View,modelViewArgs:null,modelViewEl:null,renderOnChange:!1}},i.prototype._onChangeModel=function(t){var e;return e=this.findByModel(t),e.render()},i.prototype.findByModel=function(t){var e,i,n,r;for(r=this.children,i=0,n=r.length;n>i;i++)if(e=r[i],e.model===t)return e;return null},i.prototype._calcAttachOptions=function(t){var e,i,n,r,o;for(n={el:null,method:"prepend"},i=this.collection.indexOf(t),e=1;r=this.collection.at(i-e);){if(o=this.findByModel(r),null!=o?o._isAttached:void 0){n.method="after",n.el=o.$el;break}e++}if(!n.el&&this.modelViewEl&&(n.el=this.$(this.modelViewEl),!n.el.length))throw Error("`modelViewEl` not found in this view");return n},i.prototype._cloneModelViewArgs=function(){var t;if(t=this.modelViewArgs||[{}],n.isFunction(t)&&(t=t.call(this)),n.isArray(t)||(t=[t]),t=n.map(t,n.clone),!n.isArray(t)||!n.isObject(t[0]))throw Error("`modelViewArgs` must be an array with an object as the first value");return t},i.prototype.afterRender=function(){var t,e,i,n;for(n=this.collection.models,e=0,i=n.length;i>e;e++)t=n[e],this.addOne(t);return this},i.prototype.removeOne=function(t){var e;return this.collection.contains(t)?this.collection.remove(t):(e=n.findWhere(this.children,{model:t}),null!=e&&e.dispose()),this},i.prototype.addOne=function(t){var e,i,n;return this.collection.contains(t)?this._renderedOnce?(e=this._calcAttachOptions(t),n=this._cloneModelViewArgs(),n[0].model=t,i=function(t,e,i){i.prototype=t.prototype;var n=new i,r=t.apply(n,e);return Object(r)===r?r:n}(this.modelView,n,function(){}),this.attach(i,e)):this.render():this.collection.add(t),this},i}(o.View),s.FastCollectionView=function(t){function r(){var t;if(r.__super__.constructor.apply(this,arguments),null==this.modelTemplate&&!n.isFunction(this.modelTemplateStrategy))throw Error("`modelTemplate` or a `modelTemplateStrategy` function is required");n.defaults(this,this.constructor.getDefaults(this)),n.isArray(this.collection)&&(this.collection=new o.Collection(this.collection)),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset sort",this.render),this.renderOnChange&&this.listenTo(this.collection,"change",this.addOne),this.modelEl&&(this.modelEl=(null!=(t=this.ui)?t[this.modelEl]:void 0)||this.modelEl),this.modelTemplateCtx={serialize:this.modelSerialize,template:this.modelTemplate},o.View.setTemplateStrategy(this.modelTemplateStrategy,this.modelTemplateCtx)}return e(r,t),r.getDefaults=function(t){return{collection:t.collection?null:new o.Collection,modelTemplate:null,modelSerialize:t.modelSerialize?null:function(){return this.model},modelTemplateStrategy:t.templateStrategy,modelEl:null,renderOnChange:!0}},r.prototype.afterRender=function(){if(this.$modelEl=this.modelEl?this.$(this.modelEl):this.$el,!this.$modelEl.length)throw Error("`$modelEl` not found after rendering");return this.addAll(),this},r.prototype.removeOne=function(t,e,i){var n,r;return this.collection.contains(t)?this.collection.remove(t):(n=null!=(r=null!=i?i.index:void 0)?r:i,this.removeByIndex(n)),this},r.prototype.addOne=function(t){var e;return this.collection.contains(t)?this._renderedOnce?(e=this._renderModel(t),this._insertModelHTML(e,t)):this.render():this.collection.add(t),this},r.prototype.addAll=function(){var t,e,i,n,r;for(t="",r=this.collection.models,i=0,n=r.length;n>i;i++)e=r[i],t+=this._renderModel(e);return this.$modelEl.empty()[0].innerHTML=t,this},r.prototype.removeByIndex=function(t){var e;if(e=this.findElByIndex(t),!e.length)throw Error("Unable to find el with index "+t);return e.remove(),this},r.prototype.findElByModel=function(t){return this.findElByIndex(this.collection.indexOf(t))},r.prototype.findElByIndex=function(t){return i(this.$modelEl.children()[t])},r.prototype.findModelByEl=function(t){var e;return e=i(t).closest(this.$modelEl.children()).index(),this.collection.at(e)},r.prototype._renderModel=function(t){return this.modelTemplateCtx.model=t,this.modelTemplateCtx.templateStrategy()},r.prototype._insertModelHTML=function(t,e){var n,r,o,s,l;return n=this.$modelEl.children(),l=n.length,s=this.collection.indexOf(e),l===this.collection.length?(r=i(n[s]),r.replaceWith(t)):s>=l?this.$modelEl.append(t):(o=i(n[s-1]),o.length?o.after(t):this.$modelEl.prepend(t)),this},r}(o.View),s})}).call(this);